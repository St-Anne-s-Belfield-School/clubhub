<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Fixed the type attribute in the link tag -->
    <link rel="stylesheet" type="text/css" href="style.css">
   
    <title>Club Hub</title>
</head>
<body>

 <script type="module" src="script.js"></script>
 <script type="module" src="./scriptC.js"></script>
 <script type="module">
   import {login} from './script.js';
   import {addMeetings, correctNavDisplay} from './scriptC.js';
   import {loadLeaderboard} from './leaderboardScore.js';
   window.correctNavDisplay = correctNavDisplay;
   window.addMeetings = addMeetings;
   window.loadLeaderboard = loadLeaderboard;
   correctNavDisplay();
   addMeetings();
   loadLeaderboard();
 </script>
     <!-- creates the header box and the title, inside the box -->
    <header class="header" id="header">
        <h1> St. Anne's-Belfield Club Hub</h1>
    </header>

       <!-- Creates a bar below header box with nav buttons -->
   <div class="nav">
       <!-- <a class="button" href="#calendar">Calendar</a> -->
        <button class="button" onClick = "location.replace('clubDirectory.html');">Club Directory</button>
        <button class="button" id="login" onClick = "location.replace('choose.html');">Login</button>
        <button class="button" id="logout" onclick="" >Logout</button>
        <button class="button" id="adminPageBtn"onclick="location.replace('god.html');" >Admin Page</button>
   </div>


    <!-- creates a box to hold the ranking stuff -->
   <div class="rankings">

    <div class="rankingsBox">
            <h2 class="rankingTitle"> Club Engagement Rankings (L1)</h2>
            <div class="topTenList">
                <div class="topThree">
                    <img src="images/trophy.png" alt="trophy" class="trophy">
                    <p id="firstLOne">First</p>
                    <img src="images/trophy.png" alt="trophy" class="trophy">
                </div>
                <div class="topThree">
                    <img src="images/Silver.png" alt="trophy" class="trophy">
                    <p id="secondLOne">Second</p>
                    <img src="images/Silver.png" alt="trophy" class="trophy">
                </div>
                <div class="topThree">
                    <img src="images/Bronze.png" alt="trophy" class="trophy">
                    <p id="thirdLOne">Third</p>
                    <img src="images/Bronze.png" alt="trophy" class="trophy">
                </div>
            </div>
        </div>

        <div class="rankingsBox">
            <h2 class="rankingTitle"> Club Engagement Rankings (L2)</h2>
            <div class="topTenList">
                <div class="topThree">
                    <img src="images/trophy.png" alt="trophy" class="trophy">
                    <p id="firstLTwo">First</p>
                    <img src="images/trophy.png" alt="trophy" class="trophy">
                </div>
                <div class="topThree">
                    <img src="images/Silver.png" alt="trophy" class="trophy">
                    <p id="secondLTwo">Second</p>
                    <img src="images/Silver.png" alt="trophy" class="trophy">
                </div>
                <div class="topThree">
                    <img src="images/Bronze.png" alt="trophy" class="trophy">
                    <p id="thirdLTwo">Third</p>
                    <img src="images/Bronze.png" alt="trophy" class="trophy">
                </div>
            </div>
        </div>

        <div class="rankingsBox">
            <h2 class="rankingTitle"> Club Engagement Rankings (L3)</h2>
            <div class="topTenList">
                <div class="topThree">
                    <img src="images/trophy.png" alt="trophy" class="trophy">
                    <p id="firstLThree">First</p>
                    <img src="images/trophy.png" alt="trophy" class="trophy">
                </div>
                <div class="topThree">
                    <img src="images/Silver.png" alt="trophy" class="trophy">
                    <p id="secondLThree">Second</p>
                    <img src="images/Silver.png" alt="trophy" class="trophy">
                </div>
                <div class="topThree">
                    <img src="images/Bronze.png" alt="trophy" class="trophy">
                    <p id="thirdLThree">Third</p>
                    <img src="images/Bronze.png" alt="trophy" class="trophy">
                </div>
            </div>
        </div>
   </div>
    
    <!-- Hidden Modal for Delete Confirmation -->
    <div id="eventInfoModal" class="eventInfoModal">
        <div class="eventInfoModalContent">
        <p id="meetInfoPopUp">Meeting Information:</p>
        <p id="clubPopUp">Club: </p>
        <p id="datePopUp">Date: </p>
        <p id="timePopUp">Time: </p>
        <p id="locationPopUp">Location: </p>
        <p id="descriptionPopUp">Description: </p>
        <button id="goToClub" class="confbtn"  onclick="location.replace('clubDash.html');">Go to Club Page</button>
        <br>
        <button id="confCancelDelete" class="confbtn" onclick="document.getElementById('eventInfoModal').style.display = 'none';">Close</button>
        </div>
    </div>
    <!-- END OF DELETE CONF MODAL!!!! -->
    
    <!-- Calendar Section -->
    <section id="calendar">  
        <div class="calendarTitle">
            <h1>Calendar</h1>
        </div>

        <!-- Calendar Display -->
        <div class="calendar">
            <!-- Calendar Header -->
            <div class="Cheader">
               <div id="prev" class="arrow left">
                    <div class="arrow-container">
                        <i></i>
                    </div>
                </div>
                <div id="month-year"></div>
                <div id="next" class="arrow right">
                    <div class="arrow-container">
                        <i></i>
                    </div>
                </div>
            </div>

            <!-- Days of the Week -->
            <div class="weekdays">
                <div class="dayName">Sun</div> <!-- Sunday -->
                <div class="dayName">Mon</div> <!-- Monday -->
                <div class="dayName">Tue</div> <!-- Tuesday -->
                <div class="dayName">Wed</div> <!-- Wednesday -->
                <div class="dayName">Thu</div> <!-- Thursday -->
                <div class="dayName">Fri</div> <!-- Friday -->
                <div class="dayName">Sat</div> <!-- Saturday -->
            </div>

            <!-- Calendar Days -->
            <div class="days" id="days"></div> <!-- Populated dynamically with days -->

        </div>
    </section>



<!-- Footer -->
    <div class="footer">
        <div class="logos">
            <img class="logo" src="images/stab_logo.webp" alt="logo">
        </div>
            <div class="devSplit">
                <div>Developer:</div>
                <div>Kate R. '26</div>
            </div>
  
            
<script type="module">
  // ==== Site-wide Announcement Banners (homepage only) ====
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

  // Reuse existing db if you already initialized Firebase on the page
  const firebaseConfig = {
    apiKey: "AIzaSyAH3oWF9S-ePd0352Ca-TdE5cu6oinzlXo",
    authDomain: "softwareengineering-94854.firebaseapp.com",
    projectId: "softwareengineering-94854",
    storageBucket: "softwareengineering-94854.appspot.com",
    messagingSenderId: "565847408909",
    appId: "1:565847408909:web:9e116dae6ede6b965bb044"
  };

  let db;
  try {
    if (!getApps().length) {
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    } else {
      // If another script already created a Firestore instance, try to reuse via implicit default
      db = getFirestore();
    }
  } catch (e) {
    // Fallback if multiple inits or other edge cases
    try { db = getFirestore(); } catch (_) {}
  }

  const COL = "announcements";

  function bannerDismissKey(a) {
    // include updatedAt + endAt so it reappears if admin edits or period rolls over
    return `announcement_dismissed_${a.id}_${a.updatedAt || 0}_${a.endAt || ""}`;
  }
  function isDismissed(a) { return sessionStorage.getItem(bannerDismissKey(a)) === "1"; }
  function setDismissed(a) { sessionStorage.setItem(bannerDismissKey(a), "1"); }

  function insertAfterHeader(node) {
    const header = document.getElementById("header");
    if (header && header.parentNode) header.parentNode.insertBefore(node, header.nextSibling);
    else document.body.insertBefore(node, document.body.firstChild);
  }

  function createBanner(a) {
    const wrap = document.createElement("div");
    wrap.className = "site-announcement-banner";
    wrap.innerHTML = `
      <div class="banner-content">
        <div class="banner-text"></div>
        <button class="banner-close" aria-label="Dismiss" title="Dismiss">âœ•</button>
      </div>
    `;
    wrap.querySelector(".banner-text").textContent = a.message || "";

    wrap.querySelector(".banner-close").onclick = () => {
      setDismissed(a);
      wrap.remove();
    };

    return wrap;
  }

  async function renderActiveAnnouncements() {
    if (!db) return; // silently skip if Firestore failed to init
    // Remove any previously injected banners
    document.querySelectorAll(".site-announcement-banner").forEach(n => n.remove());

    const snaps = await getDocs(collection(db, COL));
    const now = new Date();
    const active = [];
    snaps.forEach(s => {
      const d = s.data();
      if (d?.deleted) return;
      if (d?.isActive === false) return;
      if (!d?.startAt || !d?.endAt) return;
      const start = new Date(d.startAt);
      const end = new Date(d.endAt);
      if (start <= now && now <= end) {
        active.push({ id: s.id, ...d });
      }
    });

    // newest first, show at most 3
    active.sort((a, b) => (b.startAt || "").localeCompare(a.startAt || ""));
    const toShow = active.slice(0, 3);

    let inserted = 0;
    for (const a of toShow) {
      if (isDismissed(a)) continue;
      const banner = createBanner(a);
      insertAfterHeader(banner);
      inserted++;
    }
  }

  // Run once on load (homepage)
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", renderActiveAnnouncements);
  } else {
    renderActiveAnnouncements();
  }
</script>

</body>
</html>
